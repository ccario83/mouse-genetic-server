<% content_for :page_css do %>

<% end %>
<% content_for :page_js do %>
<script>
			var MPATH_ID_LIST = <%=raw @mpath_ids %>;
			var ANAT_ID_LIST = <%= @anat_ids %>;
			var STRAINS = <%= raw @selelected_strains %>;
			var YOUNGEST = <%= @youngest.nil? ? "null":@youngest %>;
			var OLDEST = <%= @oldest.nil? ? "null":@oldest %>;
			var CODE = '<%= @code.nil? ? "":@code %>';
			var SEX = '<%= @sex.nil? ? "B":@sex %>';
			var ID = '<%= @job_id %>';
		</script>
		<%= javascript_include_tag('main') %>
		<%= javascript_include_tag('underscore') %>
		<%= javascript_include_tag('jquery.tablesorter.min') %>
		<%= javascript_include_tag('phenotype_submit') %>
<% end %>

<div class="container-fluid">
	<div class="row-fluid">
		<div class="span3">
				<div class="row-fluid">
					<h4> Phenotype Selections</h4>
				</div>
				<div class="row-fluid">
					<table class="table table-striped">
						<tr>
							<td><b>Pathology</b></td>
						</tr>
						<tr>
							<td><span id="path-list"><%= PathBaseTerm.find(@mpath_ids).map { |x| x.term }.join(",") %></span></td>
						</tr>
						<tr>
							<td><b>Anatomy</b></td>
						</tr>
						<tr>
							<td><span id="anat-list"><%= MouseAnatomyTerm.find(@anat_ids).map { |x| x.term }.join(", ") %></span></td>
						</tr>
						<tr>
							<td><b>Age Range</b></td>
						</tr>
						<tr>
							<td><%=@youngest %> - <%=@oldest%></td>
						</tr>
						<tr>
							<td><b>Sex</b></td>
						</tr>
						<tr>
							<td><%= @sex_long[@sex] %></td>
						</tr>
					</table>
				</div>
		</div>
		<div class="span9">
			<div class="row-fluid">
					<h4> Statistical Summary</h4>
					<h6 style="color:#999"> Click column names to sort </h6>
				</div>
				<div class="row-fluid">
					<table id="stat-table" class="table table-hover" style="width:97%;">
						<thead>
							<tr>
								<th> Strain </th>
								<th> # Animals </th>
								<th> Frequency Value </th>
								<th> Mean Severity Value </th>
								<th> Severity Standard Error </th>
								<th><a href="#" id="sig-grouping-tooltip" rel="tooltip" data-placement="top" data-original-title="These strains have been grouped using the Tukey HSD medhod">Severity Significance Groupings</a></th>
							</tr>
						</thead>
						<tbody>
							<% @selected_strains.each do |strain| %>
							<tr>
								<td class="strain"><%= strain %></td>
								<td><%= @ns[strain] %></td>
								<td><%= ((@frequencies[strain]*1000).to_i.to_f/10).to_s+"%" %>
							</tr>
							<% end %>
						</tbody>
					</table>
				</div>
		</div>
	</div>
</div>


<div id="submit-left" onClick="window.history.back();">
	<span id="submit-left-tooltip" rel="tooltip" data-placement="right" data-original-title="View" >
		<img src="/assets/go-left.png"></img>
	</span>
</div>
<div id="submit-right">
	<a href="#" id="submit-right-tooltip" rel="tooltip" data-placement="left" data-original-title="Analyze">
		<img src="/assets/go-right.png"></img>
	</a>
</div>

<div id="please-wait" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="please-wait-label">
	<div class="modal-header">
		<h4 id="please-wait-label">Generating Statistics</h4>
	</div>
	<div class="modal-body">
		<p>Severity statistics are being generated, please wait a few seconds...</p>
	</div>
</div>

<div id="choice-modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="choose-type-label" aria-hidden="true">
	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
		<h3 id="choose-type-label">Choose a value type</h3>
	</div>
	<div class="modal-body">
		<p> The Genotype association algorithms can only analyze one set of phenotype values at a time. Would you prefer to analyze frequency, severity, or dichotomized values?</p>
		<form id="choice-form">
			<fieldset>
				<div class="control-group select optional">
					<label class="radio">
					<input type="radio" name="measure" id="frequency" value="frequency" checked>Frequency</label>
					<label class="radio">
					<input type="radio" name="measure" id="severity" value="severity">Severity</label>
					<label class="radio">
					<input type="radio" name="measure" id="dichotomized" value="dichotomized">Dichotomized</label>
				</div>
				<!--
				<div class="control-group select optional">
					<label class="select optional control-label" for="uwf_submit_emma_type">GWA Algorithm</label>
					<div class="controls">
						<select class="select optional" id="uwf_submit_emma_type" name="uwf_submit[emma_type]">
							<option value="emma">emma</option>
							<option value="emmax" selected="selected">emmax</option>
							<option value="gemma">gemma</option>
						</select>
					</div>
				</div>
				<div class="control-group select optional">
					<label class="select optional control-label" for="uwf_submit_snp_set">SNP Dataset</label>
					<div class="controls">
						<select class="select optional" id="uwf_submit_snp_set" name="uwf_submit[snp_set]">
							<option value="4M" selected="selected">4M</option>
							<option value="65M">65M</option>
						</select>
					</div>
				</div>
				-->
			</fieldset>
		</form>
	</div>
	
	<div class="modal-footer">
		<button id="choice-submit" class="btn btn-primary">Submit</button>
		<!--<a href="#description" role="button" class="btn" data-toggle="modal">Help</a>-->
		<button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
	</div>
</div>


<div class="modal hide fade in" id="description" tabindex="-1" role="dialog" aria-labelledby="descriptionLabel" aria-hidden="true">
	<div class="modal-header"> 
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
		<h3 id = "descriptionLabel"> Description </h3> 
	</div>
	<div class="modal-body">
		This tool runs the <a style="text-decoration:underline;" href="http://mouse.cs.ucla.edu/emma/">UCLA EMMA</a>,  
		<a style="text-decoration:underline;" href="http://genetics.cs.ucla.edu/emmax/">UCLA EMMAX</a>, or <a style="text-decoration:underline;" href="http://stephenslab.uchicago.edu/software.html">
		University of Chicago GEMMA </a> algorithm on our Local Server with phenotype data from multiple mouse strains. EMMA, EMMAX, and GEMMA are efficient mixed model algorithms that determine the 
		strength of associations between SNP genotypes and phenotype variations across different strains. The EMMAX algorithm approximates EMMA but is much faster and can handle larger SNP datasets. 
		GEMMA produces results as accurate as EMMA but as quickly as EMMAX and can also handle larger SNP datasets. Please refer to the algorithm developer's publications and 
		<a style="text-decoration:underline;" href="/research/links">websites</a> for more infomation. A guide to citing can be found <a style="text-decoration:underline;" href="/citing">here</a>.<br/><br/>

		<b> Instructions </b><br />
		Please format your tab-delimited phenotype file with the follwing columns: 'Strain', 'Animal_Id', 'Sex' ('Male', 'Female', or 'NA'), and a fourth column 
		including your phenotype. Rows can be individual animal data or strain means. As guidance please see a template file 
		<a style="text-decoration:underline;" href="/media/Sample_EMMA.xls">here</a>. <i>Recommended:</i> Fill out this template, save it as a tab-delimited file,
		and upload it to this form. A list of available strains and their spellings can be found 
		<a style="text-decoration:underline;" href="/media/strain_names.xls">here</a>.<br /><br />
		<i>Phenotype File:</i> Upload the phenotype file. Note: Use format as described above. <br />
		<i>GWA Algorithm:</i> Choose the desired algorithm. <br />
		<i>SNP Dataset:</i> Choose from several SNP panels.
		<hr/><br/>
	</div>
	<div class="modal-footer">
		<button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
	</div>
</div>
